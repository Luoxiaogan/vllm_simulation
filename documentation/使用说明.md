# 截断实验使用说明

## 功能概述
截断实验系统支持在仿真运行到指定批次时截断，丢弃未到达的请求，并切换到新的请求生成参数继续仿真。

## 使用流程

### Step 1: 探索模式 - 找到合适的截断点
```bash
python experiments/run_with_truncation.py --config config/explore_truncation.yaml --mode explore
```

**探索模式配置 (explore_truncation.yaml)**：
- 生成初始高到达率请求（例如 rate=5.1）
- 完整运行仿真，不截断
- `candidate_batches` 列表标记候选截断点，在图上显示为红色虚线

### Step 2: 截断模式 - 在选定点切换参数
```bash
python experiments/run_with_truncation.py --config config/apply_truncation.yaml --mode truncate
```

**截断模式配置 (apply_truncation.yaml)**：
- 读取探索模式生成的请求文件
- `batch_id` 指定单个截断点
- 在截断点丢弃未到达请求
- 使用 `rate_list` 覆盖原 types 中的到达率
- 生成新请求并继续仿真

## 配置说明

### 系统参数（不变）
```yaml
system:
  M_total: 10000
  B: 10000
  d_0: 0.003
  d_1: 0.00032
```

### rate_list 机制
- `types: "{(20,20,5.1)}"` + `rate_list: [1.1]` → 实际使用 `(20,20,1.1)`
- `types: "{(20,20,5.1),(10,10,3.0)}"` + `rate_list: [2.2, 4.4]` → 实际使用 `(20,20,2.2),(10,10,4.4)`

rate_list 元素数量必须与 types 中的类型数量一致。

## 输出说明

### 探索模式输出
- 完整运行的批次快照
- 队列动态图，红色虚线标记候选截断点
- 性能指标统计

### 截断模式输出
- 截断前后连续的批次快照
- 队列动态图，红色虚线标记实际截断点
- 截断点前后的对比分析

## 注意事项
1. 截断点 `batch_id` 必须是单个值，不能是列表
2. `rate_list` 长度必须与 types 中类型数量匹配
3. 建议先运行探索模式确定合适的截断点